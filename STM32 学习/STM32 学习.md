# STM32 学习

## 一、GPIO工作方式

<img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222003127648-1703176316840-1.png" alt="image-20231222003127648" style="zoom:100%;" />

### 1. 输入模式

<img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222032425467-1703186677911-1.png" alt="image-20231222032425467" style="zoom:100%;" />

$\color{#F00}{施密特触发器}$：可以将模拟信号转换为数字信号

- ##### 模拟输入

<img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222044232269-1703191363509-9.png" alt="image-20231222044232269" style="zoom:100%;" />

​	模拟输入模式下，IO端口的模拟信号不经过施密特触发器，直接输入到片上的模拟外设。

- ##### 浮空输入

  - 寄存器直接读取IO端口电平

  - 真值表：

    | IO端口输入 | 寄存器读取 |
    | :--------: | :--------: |
    |     1      |     1      |
    |     0      |     0      |
    |    悬空    |    1或0    |

- ##### 上拉输入

  - 寄存器直接读取IO端口电平

  - 真值表：

    | IO端口输入 | 寄存器读取 |
    | :--------: | :--------: |
    |     1      |     1      |
    |     0      |     0      |
    |    悬空    |     1      |

- ##### 下拉输入

  - 寄存器直接读取IO端口电平

  - 真值表：

    | IO端口输入 | 寄存器读取 |
    | :--------: | :--------: |
    |     1      |     1      |
    |     0      |     0      |
    |    悬空    |     0      |

- ##### 三种输入模式的区别

  | 输入模式 | 应用场合                                                     |
  | -------- | ------------------------------------------------------------ |
  | 浮空输入 | 最常用的一种模式<br>优点：输入阻抗高，MCU采集的信号是单纯的外部信号<br>缺点:没有IO信号时，读取的端口状态不确定 |
  | 上拉输入 | 当输入的信号较弱，容易受到干扰不稳定，选择上拉               |
  | 下拉输入 | 一般不常用                                                   |

  

### 2. 输出模式

<img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222035153112-1703188318822-5.png" alt="image-20231222035153112" style="zoom:100%;" />

- ##### 推挽输出

  <img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222132516251-1703222721907-11.png" alt="image-20231222132516251" style="zoom:100%;" />

  - 既可以输出高电平也可以输出低电平
  - 同一时间只有一个MOS管是导通的
    - 当P-MOS导通、N-MOS截止，输出高电平
    - 当N-MOS导通、P-MOS截止，输出低电平
  - 采用推挽输出时，驱动能力与芯片的IO电流特性有关

- ##### 开漏输出

  <img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222133626429-1703223391169-13.png" alt="image-20231222133626429" style="zoom:100%;" />

  - 只有一个N-MOS管

    - 当N-MOS导通，输出低电平
    - 当N-MOS截止，电阻可以看作无穷大，输出高阻态

  - 开漏输出模式下要想输出高电平，需要通过外部上拉电阻提供驱动输出，一般工作在电平不匹配的场合

    <img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222134418629-1703223867313-15.png" alt="image-20231222134418629" style="zoom:80%;" />

  - 开漏输出还具有“线与”的特性

    <img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222135238950-1703224366283-17.png" alt="image-20231222135238950" style="zoom:80%;" />

    当多个开漏输出引脚连接在一起，需要它们都输出高电平，才能输出高电平，但凡有一个开漏输出低电平，则所有的引脚电平都会被拉低

- ##### 推挽复用输出

  <img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222145800335-1703228286482-19.png" alt="image-20231222145800335" style="zoom:100%;" />

  与推挽输出类似，只是推挽复用输出的控制源来自片上外设，如PWM、串口等

- ##### 开漏复用输出

  <img src="./STM32%20%E5%AD%A6%E4%B9%A0.assets/image-20231222145939492-1703228383986-21.png" alt="image-20231222145939492" style="zoom:100%;" />

  与开漏输出类似，只是开漏复用输出的控制源来自片上外设，如I2C等

- ##### 推挽输出与开漏输出模式的区别

  | 输出模式 | 特点                                                         | 应用场合                                               |
  | -------- | :----------------------------------------------------------- | ------------------------------------------------------ |
  | 推挽输出 | 优点：输出高低电平与电源电压基本没有压差，可以提供较强的高电平与低电平驱动能力。<br>缺点：不支持“线与”功能。 | 可以直接驱动小于20mA的小功率外设，如发光二极管。       |
  | 开漏输出 | 优点：可以实现电平转换，输出电平取决于上拉电阻电源，可以实现“线与”功能。<br/>缺点：高电平驱动能力差，驱动能力取决于外部上拉电阻。 | 一般应用在I2C、SMBUS等通信需要“线与”功能的总线电路中。 |

  
